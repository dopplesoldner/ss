"use strict";angular.module("ssApp",["ngRoute","ui.bootstrap","nvd3","smart-table","firebase","ngProgress"]).run(["$rootScope","$location","ngProgressFactory",function(a,b,c){a.pb=c.createInstance(),a.$on("$routeChangeError",function(a,c,d,e){"AUTH_REQUIRED"===e&&b.path("/login")})}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",resolve:{init:["$location","$q","authService","apiService","chartConfigFactory",function(a,b,c,d,e){var f=b.defer(),g={};return c.firebaseAuth.$requireAuth().then(function(a){return g.currentAuth=a,d.apiData()}).then(function(a){g.apiData=a,f.resolve(g)},function(b){console.log(b),"AUTH_REQUIRED"===b&&a.path("/login"),f.reject()}),f.promise}],chartConfig:["chartConfigFactory",function(a){return a.chartConfig}]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).otherwise({redirectTo:"/"})}]),angular.module("ssApp").controller("MainCtrl",["$scope","$location","$timeout","chartConfig","init","authService","capitalizeFilter",function(a,b,c,d,e,f,g){a.apiData=e.apiData,a.currentAuth=e.currentAuth,a.btn={mode:"Basic"},a.$watch("btn.mode",function(){console.log(a.btn.mode)}),a.dataPie=[],a.dataBar=[{values:[]}],a.dataPie_advanced=[],a.dataMultiBar=[],a.reviewSources=[];for(var h in a.apiData.reviewCount)a.reviewSources.push({source:h,count:a.apiData.reviewCount[h]});a.logout=function(){f.firebaseAuth.$unauth(),b.path("/login")};var i=function(){a.apiData.average.forEach(function(b){b.Count>0&&a.dataPie.push({label:b.Name,value:b.Count}),b.Sentiment>0&&a.dataBar[0].values.push({label:b.Name,value:b.Sentiment})});var b={},c={};a.apiData.relevance.forEach(function(a){a.NamedEntity.split("|").length>1||(a.NamedEntity in b||(b[a.NamedEntity]=0),a.NamedEntity in c||(c[a.NamedEntity]=0),a.Sentiment<5?c[a.NamedEntity]+=1:b[a.NamedEntity]+=1)});var d=[],e=[];for(var f in b)d.push({label:f,value:b[f]});for(var f in c)e.push({label:f,value:c[f]});a.dataMultiBar.push({key:"positives",values:d}),a.dataMultiBar.push({key:"negatives",values:e})},j=function(b){a.activeCategory=String(b),a.rowCollection=[];var c=a.apiData.entity[b];for(var d in c){var e=c[d];for(var f in e)a.rowCollection.push({Date:e[f].Date,Text:e[f].Text,Sentiment:e[f].Sentiment,Url:e[f].Url,Source:e[f].Source})}a.dataPie_advanced=[];for(var d in c)a.dataPie_advanced.push({label:d,value:c[d].length});a.$apply()};a.chartOptions={optionsMultiBar:angular.copy(d.multiBarChart),optionsBar:angular.copy(d.barChart),optionsBarAdvanced:angular.copy(d.barChart),optionsPie:angular.copy(d.pieChart),optionsPieAdvanced:angular.copy(d.pieChart)},a.chartOptions.optionsPie.chart.pie={dispatch:{elementClick:function(b){"Basic"===a.btn.mode&&j(b.data.label)}}},i(),c(function(){j("general")})}]),angular.module("ssApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("ssApp").controller("LoginCtrl",["$scope","$location","authService","$timeout",function(a,b,c,d){a.user={email:"",password:""},a.authService=c.firebaseAuth,a.submitForm=function(){a.pb.start(),a.authService.$authWithPassword({email:a.user.email,password:a.user.password}).then(function(c){console.log("Logged in as:",c.uid),a.pb.complete(),b.path("/")})["catch"](function(b){console.error("authentication failed:",b),a.pb.complete(),a.login.authMsg="Please check your credentials and try again!",d(function(){a.login.authMsg=null},2e3)})}}]),angular.module("ssApp").filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}),angular.module("ssApp").factory("apiService",["$http","$q","authService","$rootScope",function(a,b,c,d){var e=function(){return a.get("sentimentsearch-export.json")},f=function(){var a=b.defer(),e=new Firebase(c.url);return d.pb.start(),e.once("value",function(b){d.pb.complete(),a.resolve(b.val())},function(b){d.pb.complete(),a.reject(b.code)}),a.promise};return{getData:e,apiData:f}}]),angular.module("ssApp").service("authService",["$firebaseAuth",function(a){var b="https://sentimentsearch.firebaseio.com/jones family project",c=new Firebase(b);return{url:b,firebaseAuth:a(c)}}]),angular.module("ssApp").factory("chartConfigFactory",function(){var a={pieChart:{chart:{type:"pieChart",height:350,x:function(a){return a.label},y:function(a){return a.value},showValues:!0,valueFormat:function(a){return d3.format("03d")(a)},showLegend:!1,transitionDuration:500,labelSunbeamLayout:!0,deepWatchData:!0}},barChart:{chart:{type:"multiBarHorizontalChart",height:250,x:function(a){return a.label},y:function(a){return a.value},showValues:!0,showControls:!1,showLegend:!1,valueFormat:function(a){return d3.format(",.2f")(a)},transitionDuration:500}},multiBarChart:{chart:{type:"multiBarChart",height:250,margin:{top:20,right:20,bottom:60,left:60},yAxis:{axisLabel:"Number of reviews"},xAxis:{rotateLabels:-45},reduceXTicks:!1,showControls:!1,stacked:!0,x:function(a){return a.label},y:function(a){return a.value}}}};return{chartConfig:a}}),angular.module("ssApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/login.html",'<div class="block-center mt-xl wd-xl"> <!-- START panel--> <div class="panel panel-dark panel-flat"> <div class="panel-heading text-center"> <h3>SentimentSearch</h3> </div> <div class="panel-body"> <p class="text-center pv">SIGN IN TO CONTINUE.</p> <form role="form" ng-submit="submitForm(loginForm.$valid)" name="loginForm" novalidate class="form-validate mb-lg"> <div class="form-group has-feedback"> <input id="exampleInputEmail1" type="email" name="account_email" placeholder="Email address" autocomplete="on" ng-model="user.email" required class="form-control"> <span class="fa fa-envelope form-control-feedback text-muted"></span> <span ng-show="loginForm.account_email.$dirty &amp;&amp; loginForm.account_email.$error.required" class="text-danger">This field is required</span> <span ng-show="loginForm.account_email.$dirty &amp;&amp; loginForm.account_email.$error.email" class="text-danger">This field must be a valid email address</span> </div> <div class="form-group has-feedback"> <input id="exampleInputPassword1" type="password" name="account_password" placeholder="Password" ng-model="user.password" required class="form-control"> <span class="fa fa-lock form-control-feedback text-muted"></span> <span ng-show="loginForm.account_password.$dirty &amp;&amp; loginForm.account_password.$error.required" class="text-danger">This field is required</span> </div> <button type="submit" class="btn btn-block btn-primary mt-lg">Login</button> </form> <div ng-show="login.authMsg" class="alert alert-danger text-center">{{login.authMsg}}</div> </div> </div> <!-- END panel--> <div class="p-lg text-center"> <span>SentimentSearch &copy; 2015</span> </div> </div>'),a.put("views/main.html",'<!-- top navbar--> <header ng-include="\'views/partials/top-navbar.html\'" class="topnavbar-wrapper"></header> <!-- sidebar--> <div class="container-fluid view-container"> <div class="row" style="padding-top: 10px"> <div class="col-md-9"> <h4>Jones Family Project</h4> </div> <!--<div class="col-md-2 pull-right">--> <!--<div class="btn-group">--> <!--<label ng-model="btn.mode" uib-btn-radio="\'Basic\'" class="btn btn-pill-left btn-default">Basic</label>--> <!--<label ng-model="btn.mode" uib-btn-radio="\'Advanced\'" class="btn btn-oval btn-default">Advanced</label>--> <!--</div>--> <!--</div>--> </div> <div class="row"> <div class="col-md-4"> <!-- START List group--> <ul class="list-group"> <li class="list-group-item"> <div class="row row-table pv-lg"> <div class="col-xs-6"> <p class="m0 lead">{{apiData.overall}}</p> <p class="m0"> <small>Overall Sentiment Score</small> </p> </div> <div class="col-xs-6 text-center"> <div sparkline="" data-bar-color="#23b7e5" data-height="60" data-bar-width="10" data-bar-spacing="6" data-chart-range-min="0" values="3,6,7,8,4,5" class="ng-isolate-scope"><canvas width="90" height="60" style="display: inline-block; width: 90px; height: 60px; vertical-align: top"></canvas></div> </div> </div> </li> <li class="list-group-item"> <div class="row row-table pv-lg"> <div class="col-xs-4"> <h5>Review Sources</h5> </div> <div class="col-xs-8"> <ul class="list-inline text-right"> <li ng-repeat="s in reviewSources"> <p class="m0 lead">{{s.count}}</p> <p class="m0"> <small>{{s.source}}</small> </p> </li> </ul> </div> </div> </li> </ul> <!-- END List group--> </div> <div class="col-md-8"> <!-- START bar chart--> <div class="panel"> <div class="panel-heading"> <div class="panel-title"> <div class="col-md-12"><em class="icon-pie-chart"></em> Review Breakdown</div> </div> </div> <div class="panel-body"> <div class="col-md-6"> <nvd3 options="chartOptions.optionsPie" data="dataPie"></nvd3> </div> <div class="col-md-6"> <nvd3 options="chartOptions.optionsPieAdvanced" data="dataPie_advanced"></nvd3> </div> </div> </div> <!-- END bar chart--> </div> </div> <div class="row"> <div class="col-md-4"> <!-- START bar chart--> <div id="panelChart3" class="panel"> <div class="panel-heading"> <div class="panel-title"> <div class="col-md-12"><em class="icon-bar-chart"></em> Sentiment Score per category</div> </div> </div> <!-- <div collapse="panelChart3" class="panel-wrapper collapse in graph"> --> <div class="panel-body"> <div class="col-md-12"> <nvd3 options="chartOptions.optionsBar" data="dataBar"></nvd3> </div> <div class="col-md-12"> <nvd3 options="chartOptions.optionsMultiBar" data="dataMultiBar"></nvd3> </div> </div> </div> </div> <div class="col-md-8"> <div class="panel"> <div class="panel-heading"> <div class="panel-title"> <div class="col-md-12"><em class="icon-eye"></em> {{activeCategory | capitalize}}</div> </div> </div> <div class="panel-body"> <table st-table="displayed" st-safe-src="rowCollection" class="table table-striped"> <thead> <tr> <th class="col-md-2" st-sort="Date">Date <i class="fa fa-fw fa-sort"></i></th> <th class="col-md-6">Text</th> <th class="col-md-2" st-sort="Sentiment">Sentiment <i class="fa fa-fw fa-sort"></i></th> <th class="col-md-2">Source</th> </tr> <tbody> <tr ng-repeat="row in displayed"> <td>{{row.Date}}</td> <td>{{row.Text}}</td> <td>{{row.Sentiment}}</td> <td><a ng-href="{{row.Url}}" target="_blank">{{row.Source}}</a></td> </tr> </tbody> <tfoot> <tr> <td colspan="5" class="text-center"> <div st-pagination="" st-items-by-page="14"> </div> </td> </tr> </tfoot> </thead></table> </div> </div> </div> </div> </div> <!-- end container --> <!-- Page footer--> <footer ng-include="\'views/partials/footer.html\'"></footer>'),a.put("views/partials/footer.html","<span>&copy; SentimentSearch - 2015</span>"),a.put("views/partials/top-navbar.html",'<!-- START Top Navbar--> <nav role="navigation" class="navbar topnavbar"> <!-- START navbar header--> <div class="navbar-header"> <a href="#/" class="navbar-brand"> <div class="brand-logo"> <img src="images/logo.42826323.png" alt="App Logo" class="img-responsive"> </div> <div class="brand-logo-collapsed"> <img src="images/logo-single.bbc33603.png" alt="App Logo" class="img-responsive"> </div> </a> </div> <!-- END navbar header--> <!-- START Nav wrapper--> <div class="nav-wrapper"> <ul class="nav navbar-nav navbar-right"> <li><p class="nav navbar-text">{{currentAuth.passsword.email}}</p></li> <li><a href="" ng-click="logout()">Logout <em class="icon-logout"></em></a></li> </ul> </div> </nav>')}]);